{"componentChunkName":"component---src-templates-post-js","path":"/notes/autumn-refresh/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Autumn refresh","date":"2018-11-12T00:00:00.000Z","date_pretty":"November 12th, 2018","date_from_now":"2 years ago","last_modified_at":"2020-01-30T21:21:31.000Z","last_modified_at_from_now":"5 months ago","path":"/notes/autumn-refresh/","author":null,"excerpt":"Using CSS Grid Layout Module to redesign a Jekyll site and further improve performance and accessibility.","tags":["Jekyll","Gatsby","web development","Netlify"],"image":{"childImageSharp":{"fluid":{"aspectRatio":1.8092105263157894,"src":"/static/1c19b29b80964c7354e5035533def8d5/fc20c/autumn-refresh-feature.jpg","srcSet":"/static/1c19b29b80964c7354e5035533def8d5/6e883/autumn-refresh-feature.jpg 275w,\n/static/1c19b29b80964c7354e5035533def8d5/a09ef/autumn-refresh-feature.jpg 550w,\n/static/1c19b29b80964c7354e5035533def8d5/fc20c/autumn-refresh-feature.jpg 1100w,\n/static/1c19b29b80964c7354e5035533def8d5/5d6ff/autumn-refresh-feature.jpg 1650w,\n/static/1c19b29b80964c7354e5035533def8d5/4fb49/autumn-refresh-feature.jpg 1920w","sizes":"(max-width: 1100px) 100vw, 1100px"},"fixed":{"src":"/static/1c19b29b80964c7354e5035533def8d5/fc20c/autumn-refresh-feature.jpg","height":607,"width":1100}}},"toc":true,"comments":true,"comments_locked":null,"hide_meta":null},"id":"bc6f8fb1-35af-5c34-99d1-5e4547cf8fc6","html":"<p>Lately I’ve been toying with the idea of migrating from <a href=\"https://jekyllrb.com/\"><strong>Jekyll</strong></a> to <a href=\"https://www.gatsbyjs.org/\"><strong>GatsbyJS</strong></a> (more on that in a future post). Initial tests look promising, but there are <a href=\"https://github.com/mmistakes/gatsby-test/issues/1\">some issues</a> I’m still working through.</p>\n<p>In the meantime I’ve taken visual cues from <a href=\"https://reactjs.org/docs/react-component.html\">React components</a> I built in a repo where I was <a href=\"(https://github.com/mmistakes/gatsby-test)\">playing around with Gatsby</a>, and adapted them here as standard HTML/CSS.</p>\n<h2 id=\"design-changes\" style=\"position:relative;\"><a href=\"#design-changes\" aria-label=\"design changes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Design changes</h2>\n<p>In <a href=\"https://github.com/mmistakes/made-mistakes-jekyll/releases/tag/12.0.0\">Made Mistakes v12</a> text and image where large and readible, but didn’t exactly fill the canvas elegantly. I wanted to change that with this design refresh.</p>\n<figure>\n  <div class=\"browser-frame\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; background-color: var(--input-background-color); max-width: 900px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 114.54545454545455%; position: relative; bottom: 0; left: 0; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image lazyload\" alt=\"Made Mistakes design before the refresh\" title=\"Made Mistakes design before the refresh\" data-src=\"/static/c5c524c17cdccf42d46c0ba2927738e3/062c0/mm-desktop-design-old.jpg\" data-srcset=\"/static/c5c524c17cdccf42d46c0ba2927738e3/16841/mm-desktop-design-old.jpg 275w,\n/static/c5c524c17cdccf42d46c0ba2927738e3/50c97/mm-desktop-design-old.jpg 550w,\n/static/c5c524c17cdccf42d46c0ba2927738e3/062c0/mm-desktop-design-old.jpg 900w\" sizes=\"(max-width: 900px) 100vw, 900px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  </div>\n  <figcaption><p>Site design before the refresh.</p></figcaption>\n</figure>\n<p>Since majority of the visitors to my site use modern browsers, I had a good excuse to play with <code class=\"language-text\">display: grid</code>. I’ve removed the <a href=\"http://oddbird.net/susy/\"><strong>Susy</strong> mixins</a> and most of the <code class=\"language-text\">float</code> based columns, which cut the amount of CSS I had to write considerably.</p>\n<figure>\n  <div class=\"browser-frame\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; background-color: var(--input-background-color); max-width: 900px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 68%; position: relative; bottom: 0; left: 0; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image lazyload\" alt=\"Made Mistakes design after the refresh\" title=\"Made Mistakes design after the refresh\" data-src=\"/static/3d59d241db2f959459b0a139a059a70e/062c0/mm-desktop-design-new.jpg\" data-srcset=\"/static/3d59d241db2f959459b0a139a059a70e/16841/mm-desktop-design-new.jpg 275w,\n/static/3d59d241db2f959459b0a139a059a70e/50c97/mm-desktop-design-new.jpg 550w,\n/static/3d59d241db2f959459b0a139a059a70e/062c0/mm-desktop-design-new.jpg 900w\" sizes=\"(max-width: 900px) 100vw, 900px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  </div>\n  <figcaption><p>Site design after the refresh.</p></figcaption>\n</figure>\n<p>To my eye this new layout breaks up the page better. Content comes into view earlier on the page, and there’s plenty of room for ancillary information on the right. With a little <code class=\"language-text\">position: sticky</code> sprinkled on the <code class=\"language-text\">aside</code> column, internal skip links stay fixed in view — when space allows.</p>\n<div class=\"custom-block notice\"><div class=\"custom-block-heading\">ProTip: Use the Firefox DevTools when working with CSS grid layouts</div><div class=\"custom-block-body\"><p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; background-color: var(--input-background-color); max-width: 900px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.45454545454545%; position: relative; bottom: 0; left: 0; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image lazyload\"\n        alt=\"Firefox Grid Inspector screenshot\"\n        title=\"Firefox Grid Inspector screenshot\"\n        data-src=\"/static/ded253fce685e4522fdf500f506c77f8/062c0/firefox-grid-inspector-screenshot.jpg\"\n        data-srcset=\"/static/ded253fce685e4522fdf500f506c77f8/16841/firefox-grid-inspector-screenshot.jpg 275w,\n/static/ded253fce685e4522fdf500f506c77f8/50c97/firefox-grid-inspector-screenshot.jpg 550w,\n/static/ded253fce685e4522fdf500f506c77f8/062c0/firefox-grid-inspector-screenshot.jpg 900w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p></div></div>\n<p>Out of all the major browsers, Firefox’s <a href=\"https://developer.mozilla.org/en-US/docs/Tools/Page_Inspector/How_to/Examine_grid_layouts\"><strong>Grid Inspector</strong></a> is argubly the best for examining, modifying, or debugging grid layouts.</p>\n<h2 id=\"accessibility-improvements\" style=\"position:relative;\"><a href=\"#accessibility-improvements\" aria-label=\"accessibility improvements permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Accessibility improvements</h2>\n<p>This refresh prompted me to test how accessible the site is and fix any glaring issues.</p>\n<h3 id=\"buttons-have-an-accessible-name\" style=\"position:relative;\"><a href=\"#buttons-have-an-accessible-name\" aria-label=\"buttons have an accessible name permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Buttons have an accessible name</h3>\n<blockquote>\n<p>When a button doesn’t have an accessible name, screen readers announce it as “button”, making it unusable for users who rely on screen readers.</p>\n</blockquote>\n<p>Digging in, I discovered <a href=\"http://bigfootjs.com/\"><strong>bigfoot.js</strong></a><sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup> didn’t name <code class=\"language-text\">&lt;button&gt;</code> elements that it created. Thankfully the button markup is configurable so I was able replace a set of presentational-only <code class=\"language-text\">&lt;svg&gt;</code> elements with unique names instead.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> bigfoot <span class=\"token operator\">=</span> $<span class=\"token punctuation\">.</span><span class=\"token function\">bigfoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  actionOriginalFN<span class=\"token operator\">:</span> <span class=\"token string\">'delete'</span><span class=\"token punctuation\">,</span>\n  buttonMarkup<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'&lt;div class=\"bigfoot-footnote__container\">'</span> <span class=\"token operator\">+</span>\n    <span class=\"token string\">' &lt;button href=\"#\" class=\"bigfoot-footnote__button\" rel=\"footnote\"'</span> <span class=\"token operator\">+</span>\n    <span class=\"token string\">' id=\"{{SUP:data-footnote-backlink-ref}}\"'</span> <span class=\"token operator\">+</span>\n    <span class=\"token string\">' data-footnote-number=\"{{FOOTNOTENUM}}\"'</span> <span class=\"token operator\">+</span>\n    <span class=\"token string\">' data-footnote-identifier=\"{{FOOTNOTEID}}\"'</span> <span class=\"token operator\">+</span>\n    <span class=\"token string\">' alt=\"See Footnote {{FOOTNOTENUM}}\"'</span> <span class=\"token operator\">+</span>\n    <span class=\"token string\">' data-bigfoot-footnote=\"{{FOOTNOTECONTENT}}\">'</span> <span class=\"token operator\">+</span>\n    <span class=\"token string\">' &lt;span class=\"visually-hidden\">{{FOOTNOTENUM}}&lt;/span>'</span> <span class=\"token operator\">+</span>\n    <span class=\"token string\">' &lt;/button>'</span> <span class=\"token operator\">+</span>\n    <span class=\"token string\">'&lt;/div>'</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"color-contrast-is-satisfactory\" style=\"position:relative;\"><a href=\"#color-contrast-is-satisfactory\" aria-label=\"color contrast is satisfactory permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Color contrast is satisfactory</h3>\n<p>The color of elements like captions and footer text were too light, so I darkened them. I did the same for links by giving them a contrast ratio of <code class=\"language-text\">4.77</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; background-color: var(--input-background-color); max-width: 800px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.18181818181819%; position: relative; bottom: 0; left: 0; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image lazyload\"\n        alt=\"link color contrast ratio screenshot\"\n        title=\"link color contrast ratio screenshot\"\n        data-src=\"/static/44e70e801b1e875d01a5ba8159fc4c42/acfc1/mm-link-color-contrast-raio.png\"\n        data-srcset=\"/static/44e70e801b1e875d01a5ba8159fc4c42/39133/mm-link-color-contrast-raio.png 275w,\n/static/44e70e801b1e875d01a5ba8159fc4c42/50322/mm-link-color-contrast-raio.png 550w,\n/static/44e70e801b1e875d01a5ba8159fc4c42/acfc1/mm-link-color-contrast-raio.png 800w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>The Color Picker in Chrome’s DevTools will show you the contrast ratio of text elements to help make your site more accessible to users with low-vision impairments or color-vision deficiencies.</p>\n<h2 id=\"performance-improvements\" style=\"position:relative;\"><a href=\"#performance-improvements\" aria-label=\"performance improvements permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Performance improvements</h2>\n<p>Optimizations with the biggest impact (minifying, concatenating, inlining critical CSS) I was already doing, but there was still room for improvement.</p>\n<h3 id=\"defer-offscreen-images\" style=\"position:relative;\"><a href=\"#defer-offscreen-images\" aria-label=\"defer offscreen images permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Defer offscreen images</h3>\n<blockquote>\n<p>Consider lazy-loading offscreen and hidden images after all critical resources have finished loading to lower time to interactive.</p>\n</blockquote>\n<p>Large feature images were already lazy-loaded and served responsively using <code class=\"language-text\">srcset</code> and a handful of sized images. Images found in the body <code class=\"language-text\">{{ content }}</code> of my Markdown files were not.</p>\n<p>Taking a cue from <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-remark-images\"><strong>gatsby-remark-images’</strong></a> playbook, I wrote a small plugin to convert Markdown image syntax into an <code class=\"language-text\">&lt;img&gt;</code> element with synatactically sugar for lazy-loading. To my surprise this actually worked.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># Description: Jekyll plugin to replace Markdown image syntax with lazy-load HTML markup</span>\n\n<span class=\"token constant\">Jekyll</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Hooks</span><span class=\"token punctuation\">.</span>register <span class=\"token symbol\">:posts</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:pre_render</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>post<span class=\"token punctuation\">,</span> payload<span class=\"token operator\">|</span>\n  docExt <span class=\"token operator\">=</span> post<span class=\"token punctuation\">.</span>extname<span class=\"token punctuation\">.</span>tr<span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\"># only process Markdown files</span>\n  <span class=\"token keyword\">if</span> payload<span class=\"token punctuation\">[</span><span class=\"token string\">'site'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'markdown_ext'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">include</span><span class=\"token operator\">?</span> docExt\n    newContent <span class=\"token operator\">=</span> post<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">.</span>gsub<span class=\"token punctuation\">(</span><span class=\"token regex\">/(?:!\\[(.*?)\\]\\((.*?)\\))/</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'&lt;noscript>&lt;img src=\"\\2\">&lt;/noscript>&lt;img src=\"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" data-src=\"\\2\" alt=\"\\1\" class=\"lazyload fade-in\">'</span><span class=\"token punctuation\">)</span>\n    post<span class=\"token punctuation\">.</span>content <span class=\"token operator\">=</span> newContent\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<h3 id=\"avoids-an-excessive-dom-size\" style=\"position:relative;\"><a href=\"#avoids-an-excessive-dom-size\" aria-label=\"avoids an excessive dom size permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Avoids an excessive DOM size</h3>\n<blockquote>\n<p>Browser engineers recommend pages contain fewer than ~1,500 DOM nodes. The sweet spot is a tree depth &#x3C; 32 elements and fewer than 60 children/parent element. A large DOM can increase memory usage, cause longer style calculations, and produce costly layout reflows.</p>\n</blockquote>\n<p>Trimming <code class=\"language-text\">&lt;div&gt;</code> fat where I could helped cut page weight down. Some hefty pages remain (I’m looking at your <a href=\"/paperfaces/\">PaperFaces gallery</a>, but most fall under the 1,500 DOM node threshold. In the future I hope to fix this issue with a <a href=\"https://awesome-lewin-0d1356.netlify.com/grid-example/\">gallery pagination component</a> when switching to Gatsby.</p>\n<h2 id=\"lighthouse-audits-comparison\" style=\"position:relative;\"><a href=\"#lighthouse-audits-comparison\" aria-label=\"lighthouse audits comparison permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lighthouse audits comparison</h2>\n<figure>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; background-color: var(--input-background-color); max-width: 716px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 44.36363636363637%; position: relative; bottom: 0; left: 0; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image lazyload\" alt=\"Made Mistakes audit results before optimizations\" title=\"Made Mistakes audit results before optimizations\" data-src=\"/static/3f6b77782e025a39af3fcdd8ec3364d1/6fd9a/mm-lighthouse-audit-before.png\" data-srcset=\"/static/3f6b77782e025a39af3fcdd8ec3364d1/39133/mm-lighthouse-audit-before.png 275w,\n/static/3f6b77782e025a39af3fcdd8ec3364d1/50322/mm-lighthouse-audit-before.png 550w,\n/static/3f6b77782e025a39af3fcdd8ec3364d1/6fd9a/mm-lighthouse-audit-before.png 716w\" sizes=\"(max-width: 716px) 100vw, 716px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption><p><strong>Lighthouse</strong> audit before optimizations.</p></figcaption>\n</figure>\n<figure>\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; background-color: var(--input-background-color); max-width: 716px;\">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 43.99999999999999%; position: relative; bottom: 0; left: 0; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image lazyload\" alt=\"Made Mistakes audit results after optimizations\" title=\"Made Mistakes audit results after optimizations\" data-src=\"/static/22dbfab3b72c664e2430baaf6452e4cd/6fd9a/mm-lighthouse-audit-after.png\" data-srcset=\"/static/22dbfab3b72c664e2430baaf6452e4cd/39133/mm-lighthouse-audit-after.png 275w,\n/static/22dbfab3b72c664e2430baaf6452e4cd/50322/mm-lighthouse-audit-after.png 550w,\n/static/22dbfab3b72c664e2430baaf6452e4cd/6fd9a/mm-lighthouse-audit-after.png 716w\" sizes=\"(max-width: 716px) 100vw, 716px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n  <figcaption><p><strong>Lighthouse</strong> audit after optimizations.</p></figcaption>\n</figure>\n<p>Not sure why metrics like <em>Speed Index</em> increased. But <em>Time to Interactive</em>, <em>First Meaningful Paint</em>, and <em>First CPI Idle</em> all show improvements, so I guess that’s why the site went from a 79 in performance, to an 89.</p>\n<h2 id=\"build-and-deploy\" style=\"position:relative;\"><a href=\"#build-and-deploy\" aria-label=\"build and deploy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Build and deploy</h2>\n<p>And if all of this wasn’t enough, I also made the switch away from <a href=\"https://travis-ci.org/\"><strong>Travis CI</strong></a>, to <a href=\"https://www.netlify.com/\"><strong>Netlify</strong></a>. Instead of a 48 line <code class=\"language-text\">.travis.yml</code> file I now have a three line <code class=\"language-text\">netlify.toml</code>.</p>\n<p>The Netlify builds are about 2-4 minutes faster than those with Travis CI. And look to be even quicker if I leverage undocumented <a href=\"https://www.contentful.com/blog/2018/05/17/faster-static-site-builds-part-one-process-only-what-you-need/#caching-for-the-win\">Netlify cache folders</a> that persists between builds. Using these to store the thousands of images I pipe through resizing tasks could shave another 6-8 minutes off my build.</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">\n<p>A jQuery plugin used to make footnotes less visually distracting.</p>\n<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a>\n</li>\n</ol>\n</div>","excerpt":"Lately I’ve been toying with the idea of migrating from Jekyll to GatsbyJS (more on that in a future post). Initial tests look promising…","timeToRead":5,"tableOfContents":"<ul>\n<li><a href=\"/notes/autumn-refresh/#design-changes\">Design changes</a></li>\n<li>\n<p><a href=\"/notes/autumn-refresh/#accessibility-improvements\">Accessibility improvements</a></p>\n<ul>\n<li><a href=\"/notes/autumn-refresh/#buttons-have-an-accessible-name\">Buttons have an accessible name</a></li>\n<li><a href=\"/notes/autumn-refresh/#color-contrast-is-satisfactory\">Color contrast is satisfactory</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/notes/autumn-refresh/#performance-improvements\">Performance improvements</a></p>\n<ul>\n<li><a href=\"/notes/autumn-refresh/#defer-offscreen-images\">Defer offscreen images</a></li>\n<li><a href=\"/notes/autumn-refresh/#avoids-an-excessive-dom-size\">Avoids an excessive DOM size</a></li>\n</ul>\n</li>\n<li><a href=\"/notes/autumn-refresh/#lighthouse-audits-comparison\">Lighthouse audits comparison</a></li>\n<li><a href=\"/notes/autumn-refresh/#build-and-deploy\">Build and deploy</a></li>\n</ul>"},"comments":{"edges":[{"node":{"id":"03494be4-9ebd-5fd6-943f-d9840a8bdf87","frontmatter":{"name":"Arnab Wahid","email":"2b5f4253acf477e13cea08554f070fef","friendlyDate":"November 13, 2018","iso8601Date":"2018-11-13T01:04:31.892Z","published":null},"html":"<p>Wonderful read as always, but relatively smaller compared to the last post!</p>\n<p>I’d be quite interested to read why you chose Gatsby, or why you are moving away\nfrom Jekyll.</p>\n<p>The new design looks wonderful, it think it is the best so far. Can we expect a\nsimilar looking Jekyll theme in the near future? :)</p>"}},{"node":{"id":"f79ba03f-f52c-5f78-82e9-20fbd3aa390b","frontmatter":{"name":"Michael Rose","email":"7c78c2359dc31fa27485199a1895d9e2","friendlyDate":"November 13, 2018","iso8601Date":"2018-11-13T13:26:52.744Z","published":null},"html":"<p>Stay tuned for a future post on my thoughts about Gatsby, migrating from Jekyll,\netc.</p>\n<p>As for a new theme… doubtful. I’m already stretched thin with the few I’ve\nreleased. Since this site is open sourced, there is nothing stopping anyone from\ntaking a look at what I’ve done and using it.</p>"}},{"node":{"id":"064a9915-d7d1-5592-b563-44bee814213e","frontmatter":{"name":"Aftar Fadilah","email":"ff226a69e8b16dd62afe6aaaad4cd64f","friendlyDate":"December 12, 2018","iso8601Date":"2018-12-12T09:22:27.010Z","published":null},"html":"<p>It’s always fun to learn from your great written stories than a boring step to\nstep tutorial books. Thanks for the experience share, surely will help all the\nreaders</p>"}},{"node":{"id":"4aaa66aa-e233-559d-a316-1798edd94af8","frontmatter":{"name":"Donald Boulton","email":"c1e68ec3dd3cc5dad0d017d2930b259c","friendlyDate":"February 14, 2019","iso8601Date":"2019-02-14T13:35:13.743Z","published":null},"html":"<p>Nice updates, like the bigfoot changes and additions.</p>\n<p>Test on <a href=\"https://securityheaders.com\">https://securityheaders.com</a> You could add security headers in\nnetlify.toml as below.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[[headers]]\nfor = &quot;/*&quot;\n[headers.values]\nCache-Control = &quot;public, max-age=31536000&quot;\nReferrer-Policy = &quot;strict-origin-when-cross-origin&quot;\nX-Content-Type-Options = &quot;nosniff&quot;\nX-Frame-Options = &quot;DENY&quot;\\r\\nX-XSS-Protection = &quot;1; mode=block&quot;\nAccess-Control-Allow-Origin = &quot;*&quot;\nVary = &quot;Accept-Encoding&quot;\nAccess-Control-Allow-Credentials = &quot;true&quot;\nFeature-Policy = &quot;geolocation &#39;self&#39; https://mademistakes.com; autoplay &#39;none&#39;; lazyload &#39;self&#39; https://mademistakes.com; sync-xhr &#39;self&#39; https://mademistakes.com&quot;\n[[headers]]\nfor = &quot;/assets/*&quot;\n[headers.values]\nCache-Control = &quot;public, max-age=31536000&quot;</code></pre></div>"}},{"node":{"id":"b8562d08-1ca4-578c-bed0-bdec72401f1a","frontmatter":{"name":"Mike","email":"f3dab3f351bc1677d07f831af4c6883c","friendlyDate":"February 04, 2020","iso8601Date":"2020-02-04T09:47:50.281Z","published":null},"html":"<p>I’d be interested to read about images production strategy you used with Jekyll or Gatsby. I read all your Jekyll related posts, but still missing the full picture and there is a lot of questions about workflow still.</p>\n<ol>\n<li>Why separate repos for original (feature) imgs and generated imgs? Why it is git submodule?</li>\n<li>Where you run gulp jobs to generate images? Locally?</li>\n<li>Is lazyload still a thing or not?</li>\n<li>What is step by step build→test→deploy workflow you are ok with?</li>\n</ol>\n<p>I’m using Gitlab CI/CD to build my Jekyll site with 2 evironments and pretty happy with it. But I’m quite sure it’ll became pain in the ass with responsive images generation, so I’m trying to find flexible workflow to improve pages size and loading speed. Maybe, you can point me to proper comment, post or even tut?</p>"}},{"node":{"id":"e8a978f8-1c55-5326-ae9b-690fabd37e5e","frontmatter":{"name":"Michael Rose","email":"7c78c2359dc31fa27485199a1895d9e2","friendlyDate":"February 04, 2020","iso8601Date":"2020-02-04T13:52:44.203Z","published":null},"html":"<p>@Mike</p>\n<ol>\n<li>I broke it out into a submodule so I wasn’t bloating the size of the main repo with a GB of images. For my Jekyll build, feature images are in their own folder so I could target them with a gulp task to generate multiple thumbnails as part of my responsive images strategy. I didn’t do that with the other content images as it was too much to manage. For my Gatsby build it’s much simpler… all images in a single folder… all resized, all responsive, all optimized by Gatsby and friends.</li>\n<li>For my Jekyll build the gulp image tasks run before Jekyll. I do some shuffling around of the optimized images so Jekyll doesn’t <em>see</em> them and isn’t moving large folders around as that slows the build down.</li>\n<li>Yes. I lazyload all images. For Jekyll I created a small plugin that <a href=\"https://github.com/mmistakes/made-mistakes-jekyll/blob/master/src/_plugins/markdown_img_replacement.rb\">rewrites the markup of Markdown written images</a> using the <code class=\"language-text\">data-src</code> attribute as needed by <a href=\"https://github.com/aFarkas/lazysizes\">lazysizes</a>. For Gatsby I leverage the <a href=\"https://www.gatsbyjs.org/packages/gatsby-image/\">gatsby-image</a> and <a href=\"https://www.gatsbyjs.org/packages/gatsby-remark-images/\">gatsby-remark-images</a> plugins to automatically lazyload images.</li>\n<li>For Jekyll I build locally using my gulp tasks. When happy with the results I push up to GitHub which triggers a build on Netlify, which then uses my production gulp tasks to build and deploy. For Gatsby it’s similar. But instead of having Netlify build my site I do that with Travis CI since I ran into timeout errors on Netlify’s free tier. When Travis finishes building the site, it uses<a href=\"https://github.com/netlify/cli\"><code class=\"language-text\">netlify-cli</code></a> to deploy the files.</li>\n</ol>"}},{"node":{"id":"e2dda46d-ffd6-5f5a-976d-9a3312f2d26b","frontmatter":{"name":"Mike","email":"f3dab3f351bc1677d07f831af4c6883c","friendlyDate":"April 28, 2020","iso8601Date":"2020-04-28T12:14:02.921Z","published":null},"html":"<p>@Michael</p>\n<p>Many thanks for your answers. I’ve managed my site workflow and stucking with different problems time-to-time. Your posts, forum messages, and sourcecode helps me a lot, but I’m pretty far from JS so Gulp and mostly architecture of workflow is painful for me.)</p>\n<p>Could you explain how you working with already generated assets? Git push is triggering Netlify build, but you generated responsive images locally in advance. How are you deploying this dir to your site assuming Netlify is responsive for a build? Is Netlify get generated assets as an external artifact?</p>\n<p>My life was OK before I started to mess with responsive images.)</p>"}},{"node":{"id":"93f6fdfb-ca18-5ad5-adfc-258f263ab4c3","frontmatter":{"name":"Michael Rose","email":"7c78c2359dc31fa27485199a1895d9e2","friendlyDate":"April 28, 2020","iso8601Date":"2020-04-28T14:51:34.001Z","published":null},"html":"<p>@Mike</p>\n<p>I’m no longer using this workflow or Jekyll, but you can check out my old repo and these <a href=\"https://github.com/mmistakes/made-mistakes-jekyll/tree/master/gulp/tasks\">Gulp tasks</a> to see how I was doing things.</p>\n<p>I wasn’t pushing any image or asset artifacts to Netlify. On each git commit it would trigger a build on Netlify’s end. Gulp tasks would fire off to generate CSS/JS production assets and grind through all the images to create multiple sizes. These assets were then stored in a <a href=\"https://www.contentful.com/blog/2018/05/17/faster-static-site-builds-part-one-process-only-what-you-need/#caching-for-the-win\">Netlify cache folder</a> so they could persist between builds.</p>\n<p>Took a while to get it right, but I was basically shuffling these assets between folders so they didn’t need to be rebuilt each time… only if the files changed or new ones were added.</p>"}},{"node":{"id":"75753110-e7d4-5547-b099-b75e852f4152","frontmatter":{"name":"Mike","email":"f3dab3f351bc1677d07f831af4c6883c","friendlyDate":"May 01, 2020","iso8601Date":"2020-05-01T15:49:40.153Z","published":null},"html":"<p>@Michael</p>\n<p>That was helpful. Thank you again. For now, I implemented some automation for local builds with Gulp and have plans to adapt something the same with Gitlab CI.</p>"}}]}},"pageContext":{"next":{"frontmatter":{"path":"/notes/faster-netlify-builds/","title":"Faster Netlify builds","categories":["notes"],"tags":["TIL","Netlify","Jekyll","web development"]},"fileAbsolutePath":"/home/28041/opensource/github.com/mmistakes/made-mistakes-gatsby/src/posts/notes/faster-netlify-builds.md"},"previous":{"frontmatter":{"path":"/procreate-paintings/marie-m-portrait/","title":"Water tension","categories":["procreate-paintings"],"tags":["Procreate","portrait","illustration","Sktchy","black and white","time lapse"]},"fileAbsolutePath":"/home/28041/opensource/github.com/mmistakes/made-mistakes-gatsby/src/posts/procreate-paintings/marie-m-portrait.md"}}}}